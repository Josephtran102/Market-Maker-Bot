const Web3 = require('web3');

async function checkForNewContracts() {
  const web3 = new Web3('wss://eth-mainnet.g.alchemy.com/v2/mmw3oG1KuTT3uCyycwuqH0oHSo8GLpr2');
  
  const subscription = web3.eth.subscribe('newBlockHeaders')
    .on('data', async (blockHeader) => {
      const block = await web3.eth.getBlock(blockHeader.number, true);
      if (block && block.transactions) {
        const transactionPromises = block.transactions
          .filter(transaction => transaction.to === null)
          .map(async transaction => {
            console.log('Sự kiện tạo mới hợp đồng:', transaction);
          });
        await Promise.all(transactionPromises);
      }
    })
    .on('error', (error) => {
      console.error('Lỗi:', error);
    });
    
  return subscription;
}

checkForNewContracts()
  .then((subscription) => {
    console.log('Bắt đầu lắng nghe sự kiện tạo mới hợp đồng...');
  })
  .catch((error) => {
    console.error('Lỗi khi bắt đầu lắng nghe sự kiện:', error);
  });
